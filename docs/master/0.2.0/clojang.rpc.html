<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><link href="css/default.css" rel="stylesheet" type="text/css" /><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>clojang.rpc documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Clojang</span> <span class="project-version">0.2.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="20-mid-level-api.html"><div class="inner"><span>Clojang User's Guide</span></div></a></li><li class="depth-1 "><a href="30-talking-to-servers.html"><div class="inner"><span>Talking to Servers: LFE &amp; Clojure</span></div></a></li><li class="depth-1 "><a href="31-talking-to-servers-erlang.html"><div class="inner"><span>Talking to Servers: Erlang &amp; Clojure</span></div></a></li><li class="depth-1 "><a href="32-talking-to-servers-elixir.html"><div class="inner"><span>Talking to Servers: Elixir &amp; Clojure</span></div></a></li><li class="depth-1 "><a href="40-creating-apps.html"><div class="inner"><span>Apps Tutorial</span></div></a></li><li class="depth-1 "><a href="98-other-resources.html"><div class="inner"><span>Other Resources</span></div></a></li><li class="depth-1 "><a href="99-other-versions.html"><div class="inner"><span>API Docs (All Versions)</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clojang</span></div></div></li><li class="depth-2 branch"><a href="clojang.conn.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>conn</span></div></a></li><li class="depth-2 branch"><a href="clojang.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="clojang.dev.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dev</span></div></a></li><li class="depth-2 branch"><a href="clojang.mbox.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mbox</span></div></a></li><li class="depth-2 branch"><a href="clojang.msg.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>msg</span></div></a></li><li class="depth-2 branch"><a href="clojang.node.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>node</span></div></a></li><li class="depth-2 branch current"><a href="clojang.rpc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rpc</span></div></a></li><li class="depth-2 branch"><a href="clojang.types.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>types</span></div></a></li><li class="depth-2"><a href="clojang.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="clojang.rpc.html#var-.21"><div class="inner"><span>!</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var--.3Emap"><div class="inner"><span>-&gt;map</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-deliver"><div class="inner"><span>deliver</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-exit"><div class="inner"><span>exit</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-get-msg-count"><div class="inner"><span>get-msg-count</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-get-peer"><div class="inner"><span>get-peer</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-get-self"><div class="inner"><span>get-self</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-link"><div class="inner"><span>link</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-msg-.3Erpc-data"><div class="inner"><span>msg-&gt;rpc-data</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-parse-rpc"><div class="inner"><span>parse-rpc</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-receive"><div class="inner"><span>receive</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-receive-buf"><div class="inner"><span>receive-buf</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-receive-msg"><div class="inner"><span>receive-msg</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-recv"><div class="inner"><span>recv</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-rpc.3F"><div class="inner"><span>rpc?</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-send"><div class="inner"><span>send</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-send-buf"><div class="inner"><span>send-buf</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-snd"><div class="inner"><span>snd</span></div></a></li><li class="depth-1"><a href="clojang.rpc.html#var-unlink"><div class="inner"><span>unlink</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">clojang.rpc</h1><div class="doc"><div class="markdown"><p>The <code>clojang.rpc</code> namespace has no analong in the JInterface package. This namepsace intends to provide a similar interface as that provided by the <code>clojang.conn</code> namespace: a set of functions for sending and receiving messages to and from remote processes. In this case, however, there is a very specfic client we expect to be receiving requests from and replying to: an RPC client, and one that expects this namespace to provide functions compatible with the RPC capabilities of an Erlang/OTP <code>gen_server</code>.</p></div></div><div class="public anchor" id="var-.21"><h3>!</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var--.3Emap"><h3>-&gt;map</h3><div class="usage"><code>(-&gt;map otp-msg)</code></div><div class="doc"><div class="markdown"><p>Convert the JInterface <code>OtpMsg</code> to a Clojure map, parsing any RPC data that may be included in the message.</p></div></div></div><div class="public anchor" id="var-deliver"><h3>deliver</h3><div class="usage"><code>(deliver this msg-or-exception)</code></div><div class="doc"><div class="markdown"><p>Deliver messages or communication exceptions to the recipient.</p></div></div></div><div class="public anchor" id="var-exit"><h3>exit</h3><div class="usage"><code>(exit dest-pid reason)</code></div><div class="doc"><div class="markdown"><p>An alias for <code>jiface.otp.connection/exit</code> that automatically converts the <code>reason</code> argument to an appropriate Erlang type.</p></div></div></div><div class="public anchor" id="var-get-msg-count"><h3>get-msg-count</h3><div class="usage"><code>(get-msg-count this)</code></div><div class="doc"><div class="markdown"><p>Return the number of messages currently waiting in the receive queue for this connection.</p></div></div></div><div class="public anchor" id="var-get-peer"><h3>get-peer</h3><div class="usage"><code>(get-peer this)</code></div><div class="doc"><div class="markdown"><p>Get information about the node at the peer end of this connection.</p></div></div></div><div class="public anchor" id="var-get-self"><h3>get-self</h3><div class="usage"><code>(get-self this)</code></div><div class="doc"><div class="markdown"><p>Get information about the node at the local end of this connection.</p></div></div></div><div class="public anchor" id="var-link"><h3>link</h3><div class="usage"><code>(link this dest-pid)</code></div><div class="doc"><div class="markdown"><p>Create a link between the local node and the specified process on the remote node.</p></div></div></div><div class="public anchor" id="var-msg-.3Erpc-data"><h3>msg-&gt;rpc-data</h3><div class="usage"><code>(msg-&gt;rpc-data msg-data)</code></div><div class="doc"><div class="markdown"><p>Convert RPC message data to a Clojure map, if the message contains RPC data. If not, set the <code>:rpc-data</code> value to <code>nil</code>.</p></div></div></div><div class="public anchor" id="var-parse-rpc"><h3>parse-rpc</h3><div class="usage"><code>(parse-rpc [gen-call-type [calling-pid calling-ref] [call-type module function arguments group-leader]])</code></div><div class="doc"><div class="markdown"><p>Parse the message data in an RPC message.</p></div></div></div><div class="public anchor" id="var-receive"><h3>receive</h3><div class="usage"><code>(receive &amp; args)</code></div><div class="doc"><div class="markdown"><p>This function is called by the RPC server in anticipation of a message from an Erlang RPC client. As such, it parses the <code>OtpMsg</code> for RPC content, identifies the function to call on behalf of the client, makes this call (using <code>eval</code>), and then sends the result to the calling <code>OtpPid</code> (being that of the client).</p>
<p>Note that in order for an Erlang RPC client to accept a message from an RPC server, the message sent by the server has to conform to a very specific format, a format that is not speficied anywhere except the OTP <code>gen_server</code> code. As such, this Clojure function sends a reply to the client using this format. Since the format is only specificed in OTP source code, it may change in the future, in which case this function will need to be updated.</p>
<p>The request sent by the RPC client boils down to the following chain of calls (some have been elided):  * <code>rpc:do_call/3</code>  * <code>gen_server:call/3</code>  * <code>gen:do_call/4</code></p>
<p>The response that the RPC client is expected is created/formated in the following functions, and these are what govern how this particular Clojure function sends its results back to the RPC client, especially the <code>reply/2</code> function:  * <code>gen_server:handle_msg/*</code>  * <code>gen_server:reply/2</code></p>
<p>In particular, this sending code is what we used: <code>To ! {Tag, Reply}</code> (which, in LFE, would be <code>(! pid `#(,tag ,reply))</code>).</p></div></div></div><div class="public anchor" id="var-receive-buf"><h3>receive-buf</h3><div class="usage"><code>(receive-buf this)</code><code>(receive-buf this timeout)</code></div><div class="doc"><div class="markdown"><p>Receive a raw (still encoded) message from a remote process.</p></div></div></div><div class="public anchor" id="var-receive-msg"><h3>receive-msg</h3><div class="usage"><code>(receive-msg connx)</code><code>(receive-msg connx timeout)</code></div><div class="doc"><div class="markdown"><p>An alias for <code>jiface.otp.connection/receive-msg</code> that returns the received data as Clojure data types.</p></div></div></div><div class="public anchor" id="var-recv"><h3>recv</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-rpc.3F"><h3>rpc?</h3><div class="usage"><code>(rpc? msg-data)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-send"><h3>send</h3><div class="usage"><code>(send connx dest msg)</code></div><div class="doc"><div class="markdown"><p>An alias for <code>jiface.otp.connection/send</code> that also allows for mailbox and node name arguments to be symbols, keywords, or strings.</p></div></div></div><div class="public anchor" id="var-send-buf"><h3>send-buf</h3><div class="usage"><code>(send-buf this desg msg)</code></div><div class="doc"><div class="markdown"><p>Send a pre-encoded message to a process on a remote node.</p></div></div></div><div class="public anchor" id="var-snd"><h3>snd</h3><div class="usage"></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-unlink"><h3>unlink</h3><div class="usage"><code>(unlink this dest-pid)</code></div><div class="doc"><div class="markdown"><p>Remove a link between the local node and the specified process on the remote node.</p></div></div></div></div></body></html>